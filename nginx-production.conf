# WebP Wizard - Production nginx Configuration
# Domain: webp-wizard.ai-tracks.com
# 
# 這是靜態文件部署配置（Production Mode）
# 不需要 Node.js server，直接服務 dist/ 目錄的靜態文件

server {
  # HTTP and HTTPS listeners
  listen 80;
  listen [::]:80;
  listen 443 quic;
  listen 443 ssl;
  listen [::]:443 quic;
  listen [::]:443 ssl;
  http2 on;
  http3 off;
  
  # SSL configuration (adjust paths as needed)
  {{ssl_certificate_key}}
  {{ssl_certificate}}
  
  # Domain name
  server_name webp-wizard.ai-tracks.com;
  
  # Root directory - points to the dist folder containing static files
  root /home/ai-tracks-webp-wizard/htdocs/webp-wizard.ai-tracks.com/dist;
  
  # Logging
  {{nginx_access_log}}
  {{nginx_error_log}}
  
  # Force HTTPS redirect
  if ($scheme != "https") {
    rewrite ^ https://$host$request_uri permanent;
  }
  
  # Let's Encrypt ACME challenge
  location ~ /.well-known {
    auth_basic off;
    allow all;
  }
  
  # Include any custom settings
  {{settings}}
  include /etc/nginx/global_settings;
  
  # Default index file
  index index.html;
  
  # Main location block - SPA routing support
  # All requests that don't match a file are sent to index.html
  location / {
    try_files $uri $uri/ /index.html;
  }
  
  # Static assets caching and optimization
  location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|webp|woff|woff2|ttf|eot)$ {
    # Cache for 1 year
    expires 1y;
    add_header Cache-Control "public, immutable";
    
    # Disable access log for static assets
    access_log off;
  }
  
  # Gzip compression settings
  gzip on;
  gzip_vary on;
  gzip_types text/plain text/css text/xml text/javascript 
             application/javascript application/json 
             application/xml+rss application/rss+xml 
             application/atom+xml image/svg+xml text/x-component;
  gzip_min_length 1000;
  gzip_comp_level 6;
  
  # Security headers
  add_header X-Frame-Options "SAMEORIGIN" always;
  add_header X-Content-Type-Options "nosniff" always;
  add_header X-XSS-Protection "1; mode=block" always;
}

